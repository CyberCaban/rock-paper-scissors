<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="./style.css">
</head>
    <body>
        <p>Join room</p>
        <form id="joinRoom">
            <input id="roomID">
        </form>

        <p>Your ID: <span id="user_id" onclick="copyToClipboardID()"></span></p>
        <p>Your room: <span id="current_room" onclick="copyToClipboardRoom()"></span></p>

        <ul id="messages"></ul>
        <form id="message_form"><input id="message_input"></form>


        <script src="/socket.io/socket.io.js"></script>
        <script>
            let socket = io();

            let roomJoin = document.getElementById('joinRoom');
            let inputRoomId = document.getElementById('roomID')
            let current_room = document.getElementById('current_room')

            let message_form = document.getElementById('message_form')
            let message_input = document.getElementById('message_input')
            let messages = document.getElementById('messages')
            let user_id = document.getElementById('user_id')

            let messageArray = []

            function copyToClipboardRoom() {
                navigator.clipboard.writeText(current_room.textContent)
            }
            function copyToClipboardID() {
                navigator.clipboard.writeText(user_id.textContent)
            }

            socket.on('send user id', function (socketID) {
                user_id.textContent = socketID
                console.log(socketID)
            })

            //присоединиться к комнате
            roomJoin.addEventListener('submit', function(e) {
                e.preventDefault();
                if (inputRoomId.value) {
                    socket.emit('join room', inputRoomId.value);
                    inputRoomId.value = '';
                }
            });

            //получение id комнаты юзером
            socket.on('current room', function(roomID) {
                current_room.innerText = roomID
            });

            //отправка сообщений
            message_form.addEventListener('submit', function(e){
                e.preventDefault()
                if (message_input.value) {
                    socket.emit('send message', message_input.value);
                    message_input.value = '';
                }
            })

            //получение сообщений
            socket.on('getMessage', function(message){
                messageArray.push(message)
                render()
            })

            function render() {
                messages.innerHTML = ''
                messageArray.forEach(item=>{
                    messages.insertAdjacentHTML('beforeend', `<span>${item}</span>`)
                })
                messages.scrollTop = messages.scrollHeight

                user_id.textContent = socket.id
            }

            render()
        </script>
    </body>
</html>